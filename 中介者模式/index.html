<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        function Player(name, teamColor){
            this.name = name;
            this.teamColor = teamColor;
            this.status = 'alive';
        }
        Player.prototype.win = function(){
            console.log('win: ' + this.name);
        }
        Player.prototype.lose = function(){
            console.log('lose: ' + this.name);
        }
        Player.prototype.dead = function(){
            this.status = 'dead';
            // 向中介发送消息,玩家已死亡
            playerDirector.ReceiveMessage('playerDead', this);
        }
        Player.prototype.remove = function(){
            // 移除玩家
            playerDirector.ReceiveMessage('playerRemoved', this);
        }
        Player.prototype.changeTeam(color) = function(){
            playerDirector.ReceiveMessage('playerChangeTeam', this, color);
        }
        var playerFactory = function(name, teamColor){
            var player = new Player(name, teamColor);
            playerDirector.ReceiveMessage('playerAdded', player);
            return player;
        }
        // 中介
        var playerDirector = (function(){
            var players = {};
            var oprations = {};
            oprations.playerAdded =  function(player){
                var color = player.teamColor;
                players[color] = players[color] || [];
                players[color].push(player);
            }
            oprations.playerRemoved = function(player){
                var color = player.teamColor;
                players[color] = players[color] || [];
                for(var n in players[color]){
                    if(p === players[color][i]){
                        players[color].splice(i, 1);
                    }
                }
            }
            oprations.playerChangeTeam = function(player, teamColor){
                var color = player.teamColor;
                oprations.playerRemoved(player);
                oprations.playerAdded(player);
            }
            oprations.dead = function(player){
                var color = player.teamColor;
            }
        })();
    </script>
</body>
</html>